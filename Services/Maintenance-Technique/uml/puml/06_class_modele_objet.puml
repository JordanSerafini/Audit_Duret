@startuml Class_Modele_Objet

title Modele Objet - ERP Terrain SAV

class Client {
  +client_id : INT
  +nom : VARCHAR(100)
  +prenom : VARCHAR(100)
  +type : ENUM [Particulier, Professionnel]
  +adresse : VARCHAR(255)
  +code_postal : VARCHAR(5)
  +ville : VARCHAR(100)
  +telephone : VARCHAR(15)
  +email : VARCHAR(100)
  +latitude : DECIMAL
  +longitude : DECIMAL
  +zone_id : INT
  +segment : ENUM [Bronze, Argent, Or]
  +date_creation : DATETIME
  +satisfaction_moyenne : DECIMAL
  +risque_churn : ENUM [Faible, Moyen, Eleve]
  --
  +get_historique_interventions() : List
  +get_contrat_actif() : Contrat
  +calculer_satisfaction() : DECIMAL
}

class Contrat {
  +contrat_id : INT
  +client_id : INT
  +type : ENUM [Bronze, Argent, Or]
  +date_signature : DATE
  +date_debut : DATE
  +date_fin : DATE
  +montant_annuel : DECIMAL
  +frequence_interventions : INT
  +statut : ENUM [Actif, Expire, Resilie]
  --
  +generer_interventions_automatiques() : List
  +alerter_fin_contrat(jours_avant) : void
  +renouveler() : Contrat
}

class Intervention {
  +intervention_id : INT
  +client_id : INT
  +technicien_id : INT
  +contrat_id : INT (nullable)
  +type : ENUM [Entretien, Depannage, Installation]
  +date_planifiee : DATETIME
  +date_reelle : DATETIME
  +heure_arrivee : DATETIME
  +heure_depart : DATETIME
  +duree_prevue_min : INT
  +duree_reelle_min : INT
  +statut : ENUM [A_Planifier, Planifiee, En_Cours, Terminee]
  +montant_total : DECIMAL
  +montant_refacture : DECIMAL
  +conforme : BOOLEAN
  --
  +pointer_gps_arrivee(lat, lon) : void
  +pointer_gps_depart() : void
  +generer_rapport_pdf() : File
  +calculer_refacturation() : DECIMAL
}

class Rapport {
  +rapport_id : INT
  +intervention_id : INT
  +description_travaux : TEXT
  +pieces_remplacees : JSON
  +observations : TEXT
  +etat_installation : ENUM [Conforme, Non_Conforme]
  +signature_client : BLOB
  +signature_date : DATETIME
  +pdf_file_url : VARCHAR(500)
  --
  +ajouter_photo(file) : Photo
  +envoyer_email_client() : void
  +archiver() : void
}

class Photo {
  +photo_id : INT
  +rapport_id : INT
  +file_url : VARCHAR(500)
  +type : ENUM [Avant, Apres, Detail]
  +latitude : DECIMAL
  +longitude : DECIMAL
  +date_prise : DATETIME
  --
  +upload_cloud() : void
}

class Devis {
  +devis_id : INT
  +client_id : INT
  +technicien_id : INT
  +intervention_id : INT (nullable)
  +date_creation : DATETIME
  +montant_ht : DECIMAL
  +montant_ttc : DECIMAL
  +statut : ENUM [Envoye, Accepte, Refuse]
  +validite_jours : INT
  +pdf_file_url : VARCHAR(500)
  --
  +generer_pdf() : File
  +envoyer_client() : void
  +convertir_en_commande() : Intervention
}

class Technicien {
  +technicien_id : INT
  +nom : VARCHAR(100)
  +prenom : VARCHAR(100)
  +email : VARCHAR(100)
  +telephone : VARCHAR(15)
  +specialites : JSON
  +zone_principale : VARCHAR(50)
  +satisfaction_moyenne : DECIMAL
  --
  +get_planning_jour(date) : List
  +get_tournee_optimisee(date) : List
  +calculer_km_mois() : DECIMAL
}

class EnqueteSatisfaction {
  +enquete_id : INT
  +intervention_id : INT
  +client_id : INT
  +date_envoi : DATETIME
  +date_reponse : DATETIME
  +note_globale : INT [0-10]
  +technicien_pro : BOOLEAN
  +delai_respecte : BOOLEAN
  +probleme_resolu : BOOLEAN
  +commentaire : TEXT
  --
  +calculer_nps() : INT
  +alerter_si_insatisfait() : void
}

Client "1" -- "0..*" Contrat : a
Client "1" -- "0..*" Intervention : demande
Client "1" -- "0..*" Devis : reçoit
Client "1" -- "0..*" EnqueteSatisfaction : repond

Contrat "1" -- "0..*" Intervention : genere

Intervention "1" -- "1" Rapport : produit
Intervention "1" -- "0..*" Devis : peut generer
Intervention "1" -- "0..1" EnqueteSatisfaction : declenche

Rapport "1" -- "0..*" Photo : contient

Technicien "1" -- "0..*" Intervention : realise
Technicien "1" -- "0..*" Devis : cree

note right of Intervention
  **POINTAGE GPS** :
  - heure_arrivee (auto GPS)
  - heure_depart (validation tech)
  - duree_reelle calculee
  - Si > duree_prevue +30min
    → montant_refacture (auto)
end note

note left of Devis
  **MODULE TERRAIN** :
  - Genere depuis app mobile
  - Photos integrees
  - Envoi email auto client
  - ROI : 45K€/an
end note

@enduml
