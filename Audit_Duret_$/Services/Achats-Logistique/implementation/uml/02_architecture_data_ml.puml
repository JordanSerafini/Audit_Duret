@startuml Architecture_Data_ML

title Architecture Data & ML - Achats & Logistique

left to right direction

!define SOURCE_COLOR #FFE4E1
!define INGESTION_COLOR #E0F7FA
!define STORAGE_COLOR #FFF9C4
!define PROCESS_COLOR #C8E6C9
!define CONSUME_COLOR #E1BEE7

package "Sources de DonnÃ©es" <<SOURCE_COLOR>> {
  [ğŸ“± Plateforme\nE-Procurement] as Platform
  [ğŸ—„ï¸ Sage MDE\nLegacy] as Sage
  [ğŸ”Œ APIs\nFournisseurs] as APIs
  [ğŸ“ Logs\nSystÃ¨me] as Logs
}

package "Couche Ingestion" <<INGESTION_COLOR>> {
  [âš¡ Kafka/RabbitMQ\nStreaming] as Streaming
  [ğŸ“… Airflow\nBatch ETL] as Batch
  [ğŸ”„ Change Data\nCapture (CDC)] as CDC
}

package "Data Lake (Stockage Brut)" <<STORAGE_COLOR>> {
  folder "Raw Data" {
    [/commandes/] as RawCmd
    [/articles/] as RawArt
    [/mouvements/] as RawMvt
    [/logs/] as RawLogs
  }

  folder "Processed Data" {
    [/commandes-clean/] as ProcCmd
    [/articles-unified/] as ProcArt
    [/agregats/] as ProcAgg
  }
}

package "Data Warehouse" <<STORAGE_COLOR>> {
  database "â­ ModÃ¨le en Ã‰toile" as DWH {
    component "FAIT_Commandes" as FactCmd
    component "DIM_Articles" as DimArt
    component "DIM_Fournisseurs" as DimFourn
    component "DIM_Chantiers" as DimChant
    component "DIM_Temps" as DimTemps
  }
}

package "Couche Traitement" <<PROCESS_COLOR>> {
  [ğŸ”§ dbt\nTransformations] as DBT
  [ğŸ Python\nScripts] as Python
  [ğŸ“Š AgrÃ©gations\nSQL] as SQL
}

package "Machine Learning" <<PROCESS_COLOR>> {
  [ğŸ¤– PrÃ©vision\nBesoins (LSTM)] as MLPredict
  [ğŸ” DÃ©tection\nAnomalies Prix] as MLAnomaly
  [â­ Scoring\nFournisseurs (RF)] as MLScoring
  [ğŸ“¦ PrÃ©diction\nRuptures Stock] as MLStock
  [ğŸ·ï¸ Classification\nArticles (NLP)] as MLNLP
}

package "Couche Consommation" <<CONSUME_COLOR>> {
  [ğŸ“Š Dashboards BI\n(Metabase/Superset)] as Dashboards
  [ğŸ“ˆ Reporting\nAutomatique] as Reports
  [ğŸ”” Alertes\nTemps RÃ©el] as Alerts
  [ğŸ¯ API Analytics\n(FastAPI)] as APIAnalytics
}

package "Utilisateurs Finaux" {
  actor "ğŸ‘©â€ğŸ’¼ Direction" as Dir
  actor "ğŸ‘©â€ğŸ’¼ Gestionnaire\nAchats" as Gest
  actor "ğŸ‘¨â€ğŸ’¼ Resp.\nAffaires" as Resp
  actor "ğŸ“± Apps\nMobiles/Web" as Apps
}

' Relations Sources â†’ Ingestion
Platform --> Streaming : Temps rÃ©el
Platform --> Batch : Nightly sync
Sage --> Batch : Daily export
APIs --> Streaming : Webhooks
Logs --> Streaming : Logs stream

' Relations Ingestion â†’ Data Lake Raw
Streaming --> RawCmd
Streaming --> RawMvt
Streaming --> RawLogs
Batch --> RawArt
Batch --> RawCmd

' Relations Data Lake â†’ Processing
RawCmd --> DBT
RawArt --> DBT
RawMvt --> DBT
RawLogs --> Python

DBT --> ProcCmd
DBT --> ProcArt
Python --> ProcAgg

' Relations Processed â†’ Data Warehouse
ProcCmd --> FactCmd
ProcArt --> DimArt
DBT --> DimFourn
DBT --> DimChant
SQL --> DimTemps

' Relations DWH â†’ ML
FactCmd --> MLPredict
FactCmd --> MLAnomaly
FactCmd --> MLScoring
FactCmd --> MLStock

DimArt --> MLNLP
DimArt --> MLStock

' Relations ML â†’ Consommation
MLPredict --> Alerts
MLAnomaly --> Alerts
MLScoring --> Dashboards
MLStock --> Alerts
MLNLP --> APIAnalytics

' Relations DWH â†’ Consommation
FactCmd --> Dashboards
DimArt --> Dashboards
DimFourn --> Reports

' Relations Consommation â†’ Users
Dashboards --> Dir
Dashboards --> Gest
Dashboards --> Resp

Reports --> Dir
Reports --> Gest

Alerts --> Gest
Alerts --> Resp
Alerts --> Apps

APIAnalytics --> Apps

note bottom of Streaming
  **Temps RÃ©el**
  - Commandes crÃ©Ã©es
  - Mouvements stock
  - Ã‰vÃ©nements critiques

  **Technologies**
  - Apache Kafka
  - RabbitMQ
end note

note bottom of MLPredict
  **ModÃ¨les ML DÃ©ployÃ©s**

  1. PrÃ©vision Besoins (LSTM)
     Input: Historique 24 mois
     Output: Besoins 30/60/90j

  2. Anomalies Prix
     Input: Prix historiques
     Output: Alertes Ã©carts

  3. Scoring Fournisseurs
     Input: Performance multi-critÃ¨res
     Output: Score /100

  4. Ruptures Stock
     Input: Stock + consommation
     Output: ProbabilitÃ© rupture

  5. Classification NLP
     Input: DÃ©signation article
     Output: CatÃ©gorie auto
end note

note top of DWH
  **ModÃ¨le Dimensionnel**

  FAIT: Commandes
  - Mesures: quantitÃ©, prix, dÃ©lai
  - GranularitÃ©: ligne commande

  DIMENSIONS:
  - Articles (produits)
  - Fournisseurs
  - Chantiers (lieux)
  - Temps (dates)
end note

@enduml
