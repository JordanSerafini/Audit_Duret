@startuml Network_Flux_Donnees

title Flux de Données - Architecture Cible Service Client

!define AZURE_CLOUD #E8F5E8
!define SAAS_CLOUD #E3F2FD
!define ONPREM #FFF3E0
!define EXTERNAL #F3E5F5

' Architecture Layers
package "Internet" <<Cloud>> #FFFFFF {
  component [Client Web\n(Portail)] as client
  component [App Mobile\nTechnicien] as mobile
}

package "SaaS Services" <<Cloud>> SAAS_CLOUD {
  component [HubSpot CRM\n+ Ticketing\n+ Workflows] as hubspot
  component [HubSpot\nAnalytics] as analytics
  component [Chatbot IA] as chatbot
}

package "Azure Cloud" <<Cloud>> AZURE_CLOUD {
  component [Backend API\nNode.js] as api
  component [ML Models\n(Python)] as ml
  component [Data Warehouse\nAzure SQL] as dwh
  component [Power BI\nService] as powerbi
}

package "On-Premise Duret" <<Infrastructure>> ONPREM {
  database "SAGE\nBase clients" as sage
  component [MDE ERP\nChantiers] as erp
  component [Standard\nTéléphonique] as tel
}

package "External APIs" <<External>> EXTERNAL {
  component [CTI\nRingCentral] as cti
  component [SMS Gateway\nTwilio] as sms
  component [SMTP\nSendGrid] as email
}

' Connections
client -down-> hubspot : HTTPS\nREST API
mobile -down-> api : HTTPS\nGraphQL
api -left-> hubspot : REST API

hubspot -down-> analytics : Data flow
hubspot -down-> chatbot : AI requests

hubspot -down-> dwh : ETL\nQuotidien
dwh -right-> ml : Training\ndata
ml -up-> hubspot : Prédictions
dwh -right-> powerbi : DirectQuery

cti -down-> tel : SIP Trunk
cti -up-> hubspot : Webhooks\nremontée fiche

hubspot -down-> sage : ETL Sync\nBidirectionnelle
hubspot -down-> erp : Sync\nchantiers

hubspot -right-> sms : Notifications\nclients
hubspot -right-> email : Confirmations\nautomatiques

note right of hubspot
  **Flux Principaux:**
  1. Client portail → HubSpot (RDV en ligne)
  2. Appel entrant → CTI → HubSpot (remontée fiche)
  3. Technicien app → API → HubSpot (bon intervention)
  4. HubSpot → DWH → ML (prédictions)
  5. HubSpot ↔ SAGE (sync clients bidirectionnelle)
end note

note bottom of sage
  **Sécurité:**
  - TLS 1.3 (transit)
  - AES-256 (repos)
  - OAuth 2.0 + MFA
  - RGPD compliant
  - Backup quotidien
end note

@enduml
