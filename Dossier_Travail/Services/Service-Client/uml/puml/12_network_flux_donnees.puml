@startuml Network_Flux_Donnees

title Flux de Données - Architecture Cible Service Client

nwdiag {
  network "Internet" {
    address = "Public"

    client [description = "Client Web\n(Portail)"];
    mobile [description = "App Mobile\nTechnicien"];
  }

  network "HubSpot Cloud (EU)" {
    address = "SaaS - RGPD Compliant"

    hubspot [description = "HubSpot CRM\n+ Ticketing\n+ Workflows"];
    analytics [description = "HubSpot\nAnalytics"];
    chatbot [description = "Chatbot IA"];
  }

  network "Azure Cloud" {
    address = "Cloud Services"

    api [description = "Backend API\nNode.js"];
    ml [description = "ML Models\n(Python)"];
    dwh [description = "Data Warehouse\nAzure SQL"];
    powerbi [description = "Power BI\nService"];
  }

  network "On-Premise Duret" {
    address = "192.168.1.0/24"

    sage [description = "SAGE\nBase clients"];
    erp [description = "MDE ERP\nChantiers"];
    tel [description = "Standard\nTéléphonique"];
  }

  network "Tier Services" {
    address = "External APIs"

    cti [description = "CTI\nRingCentral"];
    sms [description = "SMS Gateway\nTwilio"];
    email [description = "SMTP\nSendGrid"];
  }

  client -- hubspot [label = "HTTPS\nREST API"];
  mobile -- api [label = "HTTPS\nGraphQL"];
  api -- hubspot [label = "REST API"];

  hubspot -- analytics [label = "Data flow"];
  hubspot -- chatbot [label = "AI requests"];

  hubspot -- dwh [label = "ETL\nQuotidien"];
  dwh -- ml [label = "Training\ndata"];
  ml -- hubspot [label = "Prédictions"];
  dwh -- powerbi [label = "DirectQuery"];

  cti -- tel [label = "SIP Trunk"];
  cti -- hubspot [label = "Webhooks\nremontée fiche"];

  hubspot -- sage [label = "ETL Sync\nBidirectionnelle"];
  hubspot -- erp [label = "Sync\nchantiers"];

  hubspot -- sms [label = "Notifications\nclients"];
  hubspot -- email [label = "Confirmations\nautomatiques"];
}

note as N1
  **Flux Principaux:**
  1. Client portail → HubSpot (RDV en ligne)
  2. Appel entrant → CTI → HubSpot (remontée fiche)
  3. Technicien app → API → HubSpot (bon intervention)
  4. HubSpot → DWH → ML (prédictions)
  5. HubSpot ↔ SAGE (sync clients bidirectionnelle)
end note

note as N2
  **Sécurité:**
  - TLS 1.3 (transit)
  - AES-256 (repos)
  - OAuth 2.0 + MFA
  - RGPD compliant
  - Backup quotidien
end note

@enduml
